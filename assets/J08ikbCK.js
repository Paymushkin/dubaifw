import{s as N}from"./x_rD_Ya3.js";import{_ as D,r as f,f as L,g as Q,A as R,c as d,o as u,a as c,t as g,F as P,i as U,n as B,h as O}from"./DoG_rQuH.js";const K={class:"approved-companies-list"},S={key:0,class:"text-center py-8"},V={key:1,class:"text-center py-8"},$={class:"text-red-600"},W={key:2,class:"text-center py-8"},G={key:3,class:"space-y-3"},M={class:"text-lg font-semibold mb-4"},X={class:"space-y-3 pr-2"},j={class:"flex items-center gap-3 flex-1"},T={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},F={class:"flex-1"},H={class:"flex items-center gap-2"},J={class:"font-medium text-gray-900"},z={key:0,class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"},q={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(Y,{expose:k,emit:A}){const a=f([]),h=f(!0),m=f(""),p=f(null),w=f(null),E=s=>{if(!s||s.length<=2)return s;const e=s.split(" ");if(e.length===1){const t=e[0];return t.length<5?t.substring(0,2)+"*".repeat(t.length-2):t.substring(0,2)+"*".repeat(t.length-5)+t.substring(t.length-3)}else return e.map((o,n)=>n===0?o.substring(0,2)+"*".repeat(o.length-2):n===e.length-1&&o.length===3?o:"*".repeat(o.length)).join(" ")},C=s=>s?s.companyName+"_"+s.timestamp===p.value:!1,_=s=>{console.log("ApprovedCompaniesList: filtering companies:",s.length),console.log("ApprovedCompaniesList: first company:",s[0]);const e=s.filter(t=>t.status==="approved"||t.status==="Approved");return console.log("ApprovedCompaniesList: approved companies:",e.length),console.log("ApprovedCompaniesList: approved companies:",e),e},y=async()=>{try{if(h.value=!0,m.value="",window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){try{const e=await $fetch("/api/companies-list");if(e.success){const o=_(e.companies).sort((n,r)=>new Date(r.timestamp)-new Date(n.timestamp));if(p.value){const n=a.value.findIndex(r=>r.companyName+"_"+r.timestamp===p.value);if(n!==-1){const r=a.value.splice(n,1)[0];o.unshift(r)}}a.value=o,v("companies-count-updated",a.value.length)}else m.value=e.error||"Ошибка загрузки данных"}catch(e){console.error("API Error:",e),a.value=[],v("companies-count-updated",0),m.value="Сервис временно недоступен"}h.value=!1}else{const e="https://script.google.com/macros/s/AKfycby-9k6uo_l1HnNVUXBC3cmyEgtwb6EJBe7kRnbQ07QKlXLeNMk2QAQoKDUismUx1_DdlQ/exec",t="callback_approved_companies_"+Date.now();window[t]=n=>{if(n&&n.success){const r=n.companies.map((i,l)=>({...i,status:i.status||(l<3?"approved":"waitlist")})),b=_(r).sort((i,l)=>new Date(l.timestamp)-new Date(i.timestamp));if(p.value){const i=a.value.findIndex(l=>l.companyName+"_"+l.timestamp===p.value);if(i!==-1){const l=a.value.splice(i,1)[0];b.unshift(l)}}a.value=b,v("companies-count-updated",a.value.length)}else m.value=n.error||"Ошибка загрузки данных";h.value=!1,delete window[t],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${e}?action=getCompanies&callback=${t}`,document.head.appendChild(o)}}catch(s){console.error("Error fetching approved companies:",s),m.value="Ошибка загрузки данных",h.value=!1}},I=async()=>{try{if(window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0"))try{const e=await $fetch("/api/companies-list");if(e.success){const o=_(e.companies).sort((n,r)=>new Date(r.timestamp)-new Date(n.timestamp));a.value=o,v("companies-count-updated",a.value.length)}}catch(e){console.error("API Error in auto refresh:",e)}else{const e="https://script.google.com/macros/s/AKfycby-9k6uo_l1HnNVUXBC3cmyEgtwb6EJBe7kRnbQ07QKlXLeNMk2QAQoKDUismUx1_DdlQ/exec",t="callback_approved_auto_"+Date.now();window[t]=n=>{if(n&&n.success){const r=n.companies.map((i,l)=>({...i,status:i.status||(l<3?"approved":"waitlist")})),b=_(r).sort((i,l)=>new Date(l.timestamp)-new Date(i.timestamp));a.value=b,v("companies-count-updated",a.value.length)}delete window[t],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${e}?action=getCompanies&callback=${t}`,document.head.appendChild(o)}}catch(s){console.error("Error in auto refresh:",s)}};k({refresh:(s=null)=>{s&&(p.value=s.companyName+"_"+s.timestamp),y()},fetchCompanies:y});const v=A;return L(()=>{y(),w.value=N(I,3e4)}),Q(()=>{w.value&&clearInterval(w.value)}),R(p,s=>{s&&setTimeout(()=>{p.value=null},5e3)}),(s,e)=>(u(),d("div",K,[h.value?(u(),d("div",S,e[0]||(e[0]=[c("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):m.value?(u(),d("div",V,[c("p",$,"Ошибка загрузки: "+g(m.value),1)])):a.value.length===0?(u(),d("div",W,e[1]||(e[1]=[c("p",{class:"text-gray-600"},"Пока нет одобренных компаний",-1)]))):(u(),d("div",G,[c("h3",M,"APPROVED COMPANIES ("+g(a.value.length)+")",1),c("div",X,[(u(!0),d(P,null,U(a.value,(t,o)=>(u(),d("div",{key:o,class:B(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",C(t)?"bg-green-50 border-green-200 shadow-md":"bg-blue-50 border-blue-200"])},[c("div",j,[c("div",T,g(o+1),1),c("div",F,[c("div",H,[c("div",J,g(E(t.companyName))+g(t.industry?" | "+t.industry:""),1),C(t)?(u(),d("span",z," NEW ")):O("",!0),e[2]||(e[2]=c("span",{class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}},oe=D(q,[["__scopeId","data-v-fa8c4895"]]);export{oe as A};
