import{s as N}from"./x_rD_Ya3.js";import{_ as L,f as g,g as R,h as D,x as P,c as d,o as u,a as c,t as f,F as V,r as O,n as S,e as j}from"./LU2dGgAK.js";const B={class:"approved-companies-list"},G={key:0,class:"text-center py-8"},K={key:1,class:"text-center py-8"},$={class:"text-red-600"},U={key:2,class:"text-center py-8"},W={key:3,class:"space-y-3"},H={class:"text-lg font-semibold mb-4"},M={class:"space-y-3 pr-2"},z={class:"flex items-center gap-3 flex-1"},T={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},q={class:"flex-1"},F={class:"flex items-center gap-2"},J={class:"font-medium text-gray-900"},X={key:0,class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"},Y={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(Q,{expose:k,emit:I}){const a=g([]),h=g(!0),m=g(""),p=g(null),b=g(null),A=s=>{if(!s||s.length<=2)return s;const e=s.split(" ");if(e.length===1){const t=e[0];return t.length<5?t.substring(0,2)+"*".repeat(t.length-2):t.substring(0,2)+"*".repeat(t.length-5)+t.substring(t.length-3)}else return e.map((o,n)=>n===0?o.substring(0,2)+"*".repeat(o.length-2):n===e.length-1&&o.length===3?o:"*".repeat(o.length)).join(" ")},x=s=>s?s.companyName+"_"+s.timestamp===p.value:!1,_=s=>{console.log("ApprovedCompaniesList: filtering companies:",s.length),console.log("ApprovedCompaniesList: first company:",s[0]);const e=s.filter(t=>t.status==="approved"||t.status==="Approved");return console.log("ApprovedCompaniesList: approved companies:",e.length),console.log("ApprovedCompaniesList: approved companies:",e),e},y=async()=>{try{if(h.value=!0,m.value="",window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){try{const e=await $fetch("/api/companies-list");if(e.success){const o=_(e.companies).sort((n,r)=>new Date(r.timestamp)-new Date(n.timestamp));if(p.value){const n=a.value.findIndex(r=>r.companyName+"_"+r.timestamp===p.value);if(n!==-1){const r=a.value.splice(n,1)[0];o.unshift(r)}}a.value=o,v("companies-count-updated",a.value.length)}else m.value=e.error||"Ошибка загрузки данных"}catch(e){console.error("API Error:",e),a.value=[],v("companies-count-updated",0),m.value="Сервис временно недоступен"}h.value=!1}else{const e="https://script.google.com/macros/s/AKfycbygds0XlVVKqRN56BVHo4S25BN96LRz8urJuur9crjlOR3lgYl__MHwrgu_GmKU_wjEPg/exec",t="callback_approved_companies_"+Date.now();window[t]=n=>{if(n&&n.success){const r=n.companies.map((l,i)=>({...l,status:l.status||(i<3?"approved":"waitlist")})),w=_(r).sort((l,i)=>new Date(i.timestamp)-new Date(l.timestamp));if(p.value){const l=a.value.findIndex(i=>i.companyName+"_"+i.timestamp===p.value);if(l!==-1){const i=a.value.splice(l,1)[0];w.unshift(i)}}a.value=w,v("companies-count-updated",a.value.length)}else m.value=n.error||"Ошибка загрузки данных";h.value=!1,delete window[t],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${e}?action=getCompanies&callback=${t}`,document.head.appendChild(o)}}catch(s){console.error("Error fetching approved companies:",s),m.value="Ошибка загрузки данных",h.value=!1}},E=async()=>{try{if(window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0"))try{const e=await $fetch("/api/companies-list");if(e.success){const o=_(e.companies).sort((n,r)=>new Date(r.timestamp)-new Date(n.timestamp));a.value=o,v("companies-count-updated",a.value.length)}}catch(e){console.error("API Error in auto refresh:",e)}else{const e="https://script.google.com/macros/s/AKfycbygds0XlVVKqRN56BVHo4S25BN96LRz8urJuur9crjlOR3lgYl__MHwrgu_GmKU_wjEPg/exec",t="callback_approved_auto_"+Date.now();window[t]=n=>{if(n&&n.success){const r=n.companies.map((l,i)=>({...l,status:l.status||(i<3?"approved":"waitlist")})),w=_(r).sort((l,i)=>new Date(i.timestamp)-new Date(l.timestamp));a.value=w,v("companies-count-updated",a.value.length)}delete window[t],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${e}?action=getCompanies&callback=${t}`,document.head.appendChild(o)}}catch(s){console.error("Error in auto refresh:",s)}};k({refresh:(s=null)=>{s&&(p.value=s.companyName+"_"+s.timestamp),y()},fetchCompanies:y});const v=I;return R(()=>{y(),b.value=N(E,3e4)}),D(()=>{b.value&&clearInterval(b.value)}),P(p,s=>{s&&setTimeout(()=>{p.value=null},5e3)}),(s,e)=>(u(),d("div",B,[h.value?(u(),d("div",G,e[0]||(e[0]=[c("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):m.value?(u(),d("div",K,[c("p",$,"Ошибка загрузки: "+f(m.value),1)])):a.value.length===0?(u(),d("div",U,e[1]||(e[1]=[c("p",{class:"text-gray-600"},"Пока нет одобренных компаний",-1)]))):(u(),d("div",W,[c("h3",H,"!APPROVED COMPANIES ("+f(a.value.length)+")",1),c("div",M,[(u(!0),d(V,null,O(a.value,(t,o)=>(u(),d("div",{key:o,class:S(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",x(t)?"bg-green-50 border-green-200 shadow-md":"bg-blue-50 border-blue-200"])},[c("div",z,[c("div",T,f(o+1),1),c("div",q,[c("div",F,[c("div",J,f(A(t.companyName))+f(t.industry?" | "+t.industry:""),1),x(t)?(u(),d("span",X," NEW ")):j("",!0),e[2]||(e[2]=c("span",{class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}},oe=L(Y,[["__scopeId","data-v-6efe2d53"]]);export{oe as A};
