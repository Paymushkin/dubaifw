import{s as V}from"./x_rD_Ya3.js";import{_ as O,e as g,f as T,g as U,p as $,c as d,o as u,a as l,t as _,F as j,r as q,n as B,k as G}from"./NH6QbGxU.js";const W={class:"approved-companies-list"},z={key:0,class:"text-center py-8"},F={key:1,class:"text-center py-8"},M={class:"text-red-600"},Q={key:2,class:"text-center py-8"},Y={key:3,class:"space-y-3"},H={class:"text-lg font-semibold mb-4"},J={class:"space-y-3 pr-2"},K={class:"flex items-center gap-3 flex-1"},X={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},Z={class:"flex-1"},ee={class:"flex items-center gap-2"},te={class:"font-medium text-gray-900"},se={key:0,class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"},oe={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(ne,{expose:L,emit:P}){const a=g([]),h=g(!0),m=g(""),p=g(null),C=g(null),R=s=>{if(!s||s.length<=2)return s;const e=s.split(" ");if(e.length===1){const t=e[0];return t.length<5?t.substring(0,2)+"*".repeat(t.length-2):t.substring(0,2)+"*".repeat(t.length-5)+t.substring(t.length-3)}else return e.map((n,r)=>r===0?n.substring(0,2)+"*".repeat(n.length-2):r===e.length-1&&n.length===3?n:"*".repeat(n.length)).join(" ")},D=s=>s?s.companyName+"_"+s.timestamp===p.value:!1,x=s=>{console.log("ApprovedCompaniesList: filtering companies:",s.length),console.log("ApprovedCompaniesList: all companies with statuses:",s.map(t=>({name:t.companyName,status:t.status})));const e=s.filter(t=>t.status==="APPROVED"||t.status==="approved"||t.status==="Approved");return console.log("ApprovedCompaniesList: approved companies:",e.length),console.log("ApprovedCompaniesList: approved companies details:",e.map(t=>({name:t.companyName,status:t.status}))),e},b=async()=>{try{if(h.value=!0,m.value="",window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){try{const e=await $fetch("/api/companies-list",{query:{_t:Date.now()}});if(e.success){const n=x(e.companies).sort((r,c)=>new Date(c.timestamp)-new Date(r.timestamp));if(p.value){const r=a.value.findIndex(c=>c.companyName+"_"+c.timestamp===p.value);if(r!==-1){const c=a.value.splice(r,1)[0];n.unshift(c)}}a.value=n,v("companies-count-updated",a.value.length)}else m.value=e.error||"Ошибка загрузки данных"}catch(e){console.error("API Error:",e),a.value=[],v("companies-count-updated",0),m.value="Сервис временно недоступен"}h.value=!1}else{try{const n=await fetch("https://docs.google.com/spreadsheets/d/1jGEJIU-0Cwx151O0JczBkoaUCE48j5saab-R5eKzLfM/export?format=csv&gid=0");if(!n.ok)throw new Error(`CSV export error: ${n.statusText}`);const E=(await n.text()).split(`
`).filter(o=>o.trim()).map(o=>{const i=[];let f="",A=!1;for(let I=0;I<o.length;I++){const k=o[I];k==='"'?A=!A:k===","&&!A?(i.push(f.trim()),f=""):f+=k}return i.push(f.trim()),i}).map((o,i)=>({timestamp:o[0]||"",companyName:o[1]||"",industry:o[2]||"",name:o[3]||"",email:o[4]||"",phone:o[5]||"",message:o[6]||"",agreement1:o[7]||"",agreement2:o[8]||"",ipAddress:o[9]||"",userAgent:o[10]||"",status:o[11]||"WAITLIST"})).filter(o=>o.companyName),y=x(E),N=y.sort((o,i)=>new Date(i.timestamp)-new Date(o.timestamp));if(p.value){const o=a.value.findIndex(i=>i.companyName+"_"+i.timestamp===p.value);if(o!==-1){const i=a.value.splice(o,1)[0];N.unshift(i)}}a.value=N,v("companies-count-updated",a.value.length),console.log("Approved companies loaded from Google Sheets:",y.length)}catch(e){console.error("CSV fetch error:",e),m.value="Ошибка загрузки данных"}h.value=!1}}catch(s){console.error("Error fetching approved companies:",s),m.value="Ошибка загрузки данных",h.value=!1}},S=async()=>{try{if(window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0"))try{const e=await $fetch("/api/companies-list",{query:{_t:Date.now()}});if(e.success){const n=x(e.companies).sort((r,c)=>new Date(c.timestamp)-new Date(r.timestamp));a.value=n,v("companies-count-updated",a.value.length)}}catch(e){console.error("API Error in auto refresh:",e)}else{const e="https://script.google.com/macros/s/AKfycbxUuh8iEc5YE8k2q5e36DE66OpYPetpEOA0YdpQm0QwRXqqEcBDPcU5xP0RZI71R-bsbA/exec",t="callback_approved_auto_"+Date.now();window[t]=r=>{if(r&&r.success){const w=x(r.companies).sort((E,y)=>new Date(y.timestamp)-new Date(E.timestamp));a.value=w,v("companies-count-updated",a.value.length)}delete window[t],document.head.removeChild(n)};const n=document.createElement("script");n.src=`${e}?action=getCompanies&callback=${t}&_t=${Date.now()}`,document.head.appendChild(n)}}catch(s){console.error("Error in auto refresh:",s)}};L({refresh:(s=null)=>{s&&(p.value=s.companyName+"_"+s.timestamp),b()},fetchCompanies:b});const v=P;return T(()=>{b(),C.value=V(S,3e4)}),U(()=>{C.value&&clearInterval(C.value)}),$(p,s=>{s&&setTimeout(()=>{p.value=null},5e3)}),(s,e)=>(u(),d("div",W,[h.value?(u(),d("div",z,e[0]||(e[0]=[l("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):m.value?(u(),d("div",F,[l("p",M,"Ошибка загрузки: "+_(m.value),1)])):a.value.length===0?(u(),d("div",Q,e[1]||(e[1]=[l("p",{class:"text-gray-600"},"Пока нет одобренных компаний",-1)]))):(u(),d("div",Y,[l("h3",H,"APPROVED COMPANIES ("+_(a.value.length)+")",1),l("div",J,[(u(!0),d(j,null,q(a.value,(t,n)=>(u(),d("div",{key:n,class:B(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",D(t)?"bg-green-50 border-green-200 shadow-md":"bg-blue-50 border-blue-200"])},[l("div",K,[l("div",X,_(n+1),1),l("div",Z,[l("div",ee,[l("div",te,_(R(t.companyName))+_(t.industry?" | "+t.industry:""),1),D(t)?(u(),d("span",se," NEW ")):G("",!0),e[2]||(e[2]=l("span",{class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}},le=O(oe,[["__scopeId","data-v-0a614186"]]);export{le as A};
