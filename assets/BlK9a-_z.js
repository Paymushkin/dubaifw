import{s as E}from"./x_rD_Ya3.js";import{_ as A,f,g as N,h as L,x as G,c as d,o as u,a as r,t as g,F as R,r as D,n as O,e as j}from"./CzDHrOlg.js";const P={class:"approved-companies-list"},T={key:0,class:"text-center py-8"},U={key:1,class:"text-center py-8"},W={class:"text-red-600"},V={key:2,class:"text-center py-8"},B={key:3,class:"space-y-3"},$={class:"text-lg font-semibold mb-4"},F={class:"space-y-3 pr-2"},K={class:"flex items-center gap-3 flex-1"},S={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},Y={class:"flex-1"},q={class:"flex items-center gap-2"},H={class:"font-medium text-gray-900"},J={key:0,class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"},M={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(Q,{expose:C,emit:w}){const a=f([]),v=f(!0),m=f(""),c=f(null),_=f(null),k=t=>{if(!t||t.length<=2)return t;const s=t.split(" ");if(s.length===1){const e=s[0];return e.length<5?e.substring(0,2)+"*".repeat(e.length-2):e.substring(0,2)+"*".repeat(e.length-5)+e.substring(e.length-3)}else return s.map((n,o)=>o===0?n.substring(0,2)+"*".repeat(n.length-2):o===s.length-1&&n.length===3?n:"*".repeat(n.length)).join(" ")},y=t=>t?t.companyName+"_"+t.timestamp===c.value:!1,x=async()=>{try{if(v.value=!0,m.value="",window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){const s=await $fetch("/api/companies-list");if(s.success){const n=s.companies.filter(o=>o.status==="approved"||o.status==="Approved").sort((o,l)=>new Date(l.timestamp)-new Date(o.timestamp));if(c.value){const o=a.value.findIndex(l=>l.companyName+"_"+l.timestamp===c.value);if(o!==-1){const l=a.value.splice(o,1)[0];n.unshift(l)}}a.value=n,b("companies-count-updated",a.value.length)}else m.value=s.error||"Ошибка загрузки данных";v.value=!1}else{const s="https://script.google.com/macros/s/AKfycbxbWqpE_TR7HJoClggVpGBYdUGcssKxWOpbFAa7nZGQp69jrE0hUxLiiCx5nY8T_x70jg/exec",e="callback_approved_companies_"+Date.now();window[e]=o=>{if(o&&o.success){const p=o.companies.filter(i=>i.status==="approved"||i.status==="Approved").sort((i,h)=>new Date(h.timestamp)-new Date(i.timestamp));if(c.value){const i=a.value.findIndex(h=>h.companyName+"_"+h.timestamp===c.value);if(i!==-1){const h=a.value.splice(i,1)[0];p.unshift(h)}}a.value=p,b("companies-count-updated",a.value.length)}else m.value=o.error||"Ошибка загрузки данных";v.value=!1,delete window[e],document.head.removeChild(n)};const n=document.createElement("script");n.src=`${s}?action=getCompanies&callback=${e}`,document.head.appendChild(n)}}catch(t){console.error("Error fetching approved companies:",t),m.value="Ошибка загрузки данных",v.value=!1}},I=async()=>{try{const t="https://script.google.com/macros/s/AKfycbxbWqpE_TR7HJoClggVpGBYdUGcssKxWOpbFAa7nZGQp69jrE0hUxLiiCx5nY8T_x70jg/exec",s="callback_approved_auto_"+Date.now();window[s]=n=>{if(n&&n.success){const l=n.companies.filter(p=>p.status==="approved"||p.status==="Approved").sort((p,i)=>new Date(i.timestamp)-new Date(p.timestamp));a.value=l,b("companies-count-updated",a.value.length)}delete window[s],document.head.removeChild(e)};const e=document.createElement("script");e.src=`${t}?action=getCompanies&callback=${s}`,document.head.appendChild(e)}catch(t){console.error("Error in auto refresh:",t)}};C({refresh:(t=null)=>{t&&(c.value=t.companyName+"_"+t.timestamp),x()},fetchCompanies:x});const b=w;return N(()=>{x(),_.value=E(I,3e4)}),L(()=>{_.value&&clearInterval(_.value)}),G(c,t=>{t&&setTimeout(()=>{c.value=null},5e3)}),(t,s)=>(u(),d("div",P,[v.value?(u(),d("div",T,s[0]||(s[0]=[r("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):m.value?(u(),d("div",U,[r("p",W,"Ошибка загрузки: "+g(m.value),1)])):a.value.length===0?(u(),d("div",V,s[1]||(s[1]=[r("p",{class:"text-gray-600"},"Пока нет одобренных компаний",-1)]))):(u(),d("div",B,[r("h3",$,"APPROVED COMPANIES ("+g(a.value.length)+")",1),r("div",F,[(u(!0),d(R,null,D(a.value,(e,n)=>(u(),d("div",{key:n,class:O(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",y(e)?"bg-green-50 border-green-200 shadow-md":"bg-blue-50 border-blue-200"])},[r("div",K,[r("div",S,g(n+1),1),r("div",Y,[r("div",q,[r("div",H,g(k(e.companyName))+g(e.industry?" | "+e.industry:""),1),y(e)?(u(),d("span",J," NEW ")):j("",!0),s[2]||(s[2]=r("span",{class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}},te=A(M,[["__scopeId","data-v-9de8885b"]]);export{te as A};
