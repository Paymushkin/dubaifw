import{s as N}from"./x_rD_Ya3.js";import{_ as E,r as f,f as D,g as L,A as R,c as p,o as d,a as r,t as _,F as P,i as V,n as O,h as $}from"./BcE2RWOV.js";const j={class:"approved-companies-list"},B={key:0,class:"text-center py-8"},G={key:1,class:"text-center py-8"},K={class:"text-red-600"},S={key:2,class:"text-center py-8"},U={key:3,class:"space-y-3"},q={class:"text-lg font-semibold mb-4"},H={class:"space-y-3 pr-2"},M={class:"flex items-center gap-3 flex-1"},z={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},T={class:"flex-1"},W={class:"flex items-center gap-2"},F={class:"font-medium text-gray-900"},J={key:0,class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"},X={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(Y,{expose:x,emit:k}){const a=f([]),h=f(!0),u=f(""),i=f(null),y=f(null),A=s=>{if(!s||s.length<=2)return s;const t=s.split(" ");if(t.length===1){const e=t[0];return e.length<5?e.substring(0,2)+"*".repeat(e.length-2):e.substring(0,2)+"*".repeat(e.length-5)+e.substring(e.length-3)}else return t.map((o,n)=>n===0?o.substring(0,2)+"*".repeat(o.length-2):n===t.length-1&&o.length===3?o:"*".repeat(o.length)).join(" ")},C=s=>s?s.companyName+"_"+s.timestamp===i.value:!1,w=s=>{console.log("ApprovedCompaniesList: filtering companies:",s.length),console.log("ApprovedCompaniesList: all companies with statuses:",s.map(e=>({name:e.companyName,status:e.status})));const t=s.filter(e=>e.status==="APPROVED"||e.status==="approved"||e.status==="Approved");return console.log("ApprovedCompaniesList: approved companies:",t.length),console.log("ApprovedCompaniesList: approved companies details:",t.map(e=>({name:e.companyName,status:e.status}))),t},b=async()=>{try{if(h.value=!0,u.value="",window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){try{const t=await $fetch("/api/companies-list",{query:{_t:Date.now()}});if(t.success){const o=w(t.companies).sort((n,l)=>new Date(l.timestamp)-new Date(n.timestamp));if(i.value){const n=a.value.findIndex(l=>l.companyName+"_"+l.timestamp===i.value);if(n!==-1){const l=a.value.splice(n,1)[0];o.unshift(l)}}a.value=o,v("companies-count-updated",a.value.length)}else u.value=t.error||"Ошибка загрузки данных"}catch(t){console.error("API Error:",t),a.value=[],v("companies-count-updated",0),u.value="Сервис временно недоступен"}h.value=!1}else{const t="https://script.google.com/macros/s/AKfycbygds0XlVVKqRN56BVHo4S25BN96LRz8urJuur9crjlOR3lgYl__MHwrgu_GmKU_wjEPg/exec",e="callback_approved_companies_"+Date.now();window[e]=n=>{if(n&&n.success){const g=w(n.companies).sort((m,c)=>new Date(c.timestamp)-new Date(m.timestamp));if(i.value){const m=a.value.findIndex(c=>c.companyName+"_"+c.timestamp===i.value);if(m!==-1){const c=a.value.splice(m,1)[0];g.unshift(c)}}a.value=g,v("companies-count-updated",a.value.length)}else u.value=n.error||"Ошибка загрузки данных";h.value=!1,delete window[e],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${t}?action=getCompanies&callback=${e}&_t=${Date.now()}`,document.head.appendChild(o)}}catch(s){console.error("Error fetching approved companies:",s),u.value="Ошибка загрузки данных",h.value=!1}},I=async()=>{try{if(window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0"))try{const t=await $fetch("/api/companies-list",{query:{_t:Date.now()}});if(t.success){const o=w(t.companies).sort((n,l)=>new Date(l.timestamp)-new Date(n.timestamp));a.value=o,v("companies-count-updated",a.value.length)}}catch(t){console.error("API Error in auto refresh:",t)}else{const t="https://script.google.com/macros/s/AKfycbygds0XlVVKqRN56BVHo4S25BN96LRz8urJuur9crjlOR3lgYl__MHwrgu_GmKU_wjEPg/exec",e="callback_approved_auto_"+Date.now();window[e]=n=>{if(n&&n.success){const g=w(n.companies).sort((m,c)=>new Date(c.timestamp)-new Date(m.timestamp));a.value=g,v("companies-count-updated",a.value.length)}delete window[e],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${t}?action=getCompanies&callback=${e}&_t=${Date.now()}`,document.head.appendChild(o)}}catch(s){console.error("Error in auto refresh:",s)}};x({refresh:(s=null)=>{s&&(i.value=s.companyName+"_"+s.timestamp),b()},fetchCompanies:b});const v=k;return D(()=>{b(),y.value=N(I,3e4)}),L(()=>{y.value&&clearInterval(y.value)}),R(i,s=>{s&&setTimeout(()=>{i.value=null},5e3)}),(s,t)=>(d(),p("div",j,[h.value?(d(),p("div",B,t[0]||(t[0]=[r("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):u.value?(d(),p("div",G,[r("p",K,"Ошибка загрузки: "+_(u.value),1)])):a.value.length===0?(d(),p("div",S,t[1]||(t[1]=[r("p",{class:"text-gray-600"},"Пока нет одобренных компаний",-1)]))):(d(),p("div",U,[r("h3",q,"APPROVED COMPANIES ("+_(a.value.length)+")",1),r("div",H,[(d(!0),p(P,null,V(a.value,(e,o)=>(d(),p("div",{key:o,class:O(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",C(e)?"bg-green-50 border-green-200 shadow-md":"bg-blue-50 border-blue-200"])},[r("div",M,[r("div",z,_(o+1),1),r("div",T,[r("div",W,[r("div",F,_(A(e.companyName))+_(e.industry?" | "+e.industry:""),1),C(e)?(d(),p("span",J," NEW ")):$("",!0),t[2]||(t[2]=r("span",{class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}},se=E(X,[["__scopeId","data-v-af8739fb"]]);export{se as A};
