import{s as N}from"./x_rD_Ya3.js";import{_ as R,r as g,f as D,g as E,A as L,c as p,o as d,a as r,t as _,F as P,i as G,n as O,h as S}from"./MIwax5nq.js";const $={class:"approved-companies-list"},j={key:0,class:"text-center py-8"},K={key:1,class:"text-center py-8"},V={class:"text-red-600"},M={key:2,class:"text-center py-8"},X={key:3,class:"space-y-3"},Z={class:"text-lg font-semibold mb-4"},z={class:"space-y-3 pr-2"},B={class:"flex items-center gap-3 flex-1"},T={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},U={class:"flex-1"},W={class:"flex items-center gap-2"},q={class:"font-medium text-gray-900"},F={key:0,class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"},Q={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(Y,{expose:x,emit:A}){const a=g([]),h=g(!0),u=g(""),l=g(null),C=g(null),k=s=>{if(!s||s.length<=2)return s;const t=s.split(" ");if(t.length===1){const e=t[0];return e.length<5?e.substring(0,2)+"*".repeat(e.length-2):e.substring(0,2)+"*".repeat(e.length-5)+e.substring(e.length-3)}else return t.map((o,n)=>n===0?o.substring(0,2)+"*".repeat(o.length-2):n===t.length-1&&o.length===3?o:"*".repeat(o.length)).join(" ")},y=s=>s?s.companyName+"_"+s.timestamp===l.value:!1,w=s=>{console.log("ApprovedCompaniesList: filtering companies:",s.length),console.log("ApprovedCompaniesList: all companies with statuses:",s.map(e=>({name:e.companyName,status:e.status})));const t=s.filter(e=>e.status==="APPROVED"||e.status==="approved"||e.status==="Approved");return console.log("ApprovedCompaniesList: approved companies:",t.length),console.log("ApprovedCompaniesList: approved companies details:",t.map(e=>({name:e.companyName,status:e.status}))),t},b=async()=>{try{if(h.value=!0,u.value="",window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){try{const t=await $fetch("/api/companies-list",{query:{_t:Date.now()}});if(t.success){const o=w(t.companies).sort((n,i)=>new Date(i.timestamp)-new Date(n.timestamp));if(l.value){const n=a.value.findIndex(i=>i.companyName+"_"+i.timestamp===l.value);if(n!==-1){const i=a.value.splice(n,1)[0];o.unshift(i)}}a.value=o,v("companies-count-updated",a.value.length)}else u.value=t.error||"Ошибка загрузки данных"}catch(t){console.error("API Error:",t),a.value=[],v("companies-count-updated",0),u.value="Сервис временно недоступен"}h.value=!1}else{const t="https://script.google.com/macros/s/AKfycbwXeRReRGMr-ud3ZjY2btAGZkagSKRe0pXvCfLiC8K4mGSNfrIiQ6jOtw_c4h5uPzAiSw/exec",e="callback_approved_companies_"+Date.now();window[e]=n=>{if(n&&n.success){const f=w(n.companies).sort((m,c)=>new Date(c.timestamp)-new Date(m.timestamp));if(l.value){const m=a.value.findIndex(c=>c.companyName+"_"+c.timestamp===l.value);if(m!==-1){const c=a.value.splice(m,1)[0];f.unshift(c)}}a.value=f,v("companies-count-updated",a.value.length)}else u.value=n.error||"Ошибка загрузки данных";h.value=!1,delete window[e],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${t}?action=getCompanies&callback=${e}&_t=${Date.now()}`,document.head.appendChild(o)}}catch(s){console.error("Error fetching approved companies:",s),u.value="Ошибка загрузки данных",h.value=!1}},I=async()=>{try{if(window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0"))try{const t=await $fetch("/api/companies-list",{query:{_t:Date.now()}});if(t.success){const o=w(t.companies).sort((n,i)=>new Date(i.timestamp)-new Date(n.timestamp));a.value=o,v("companies-count-updated",a.value.length)}}catch(t){console.error("API Error in auto refresh:",t)}else{const t="https://script.google.com/macros/s/AKfycbwXeRReRGMr-ud3ZjY2btAGZkagSKRe0pXvCfLiC8K4mGSNfrIiQ6jOtw_c4h5uPzAiSw/exec",e="callback_approved_auto_"+Date.now();window[e]=n=>{if(n&&n.success){const f=w(n.companies).sort((m,c)=>new Date(c.timestamp)-new Date(m.timestamp));a.value=f,v("companies-count-updated",a.value.length)}delete window[e],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${t}?action=getCompanies&callback=${e}&_t=${Date.now()}`,document.head.appendChild(o)}}catch(s){console.error("Error in auto refresh:",s)}};x({refresh:(s=null)=>{s&&(l.value=s.companyName+"_"+s.timestamp),b()},fetchCompanies:b});const v=A;return D(()=>{b(),C.value=N(I,3e4)}),E(()=>{C.value&&clearInterval(C.value)}),L(l,s=>{s&&setTimeout(()=>{l.value=null},5e3)}),(s,t)=>(d(),p("div",$,[h.value?(d(),p("div",j,t[0]||(t[0]=[r("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):u.value?(d(),p("div",K,[r("p",V,"Ошибка загрузки: "+_(u.value),1)])):a.value.length===0?(d(),p("div",M,t[1]||(t[1]=[r("p",{class:"text-gray-600"},"Пока нет одобренных компаний",-1)]))):(d(),p("div",X,[r("h3",Z,"APPROVED COMPANIES ("+_(a.value.length)+")",1),r("div",z,[(d(!0),p(P,null,G(a.value,(e,o)=>(d(),p("div",{key:o,class:O(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",y(e)?"bg-green-50 border-green-200 shadow-md":"bg-blue-50 border-blue-200"])},[r("div",B,[r("div",T,_(o+1),1),r("div",U,[r("div",W,[r("div",q,_(k(e.companyName))+_(e.industry?" | "+e.industry:""),1),y(e)?(d(),p("span",F," NEW ")):S("",!0),t[2]||(t[2]=r("span",{class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}},se=R(Q,[["__scopeId","data-v-ac139361"]]);export{se as A};
