import{s as N}from"./x_rD_Ya3.js";import{f as v,x as A,g as L,h as D,c as p,o as u,a as d,t as f,F as G,r as R,n as O,e as j}from"./Catnwx5_.js";const P={class:"approved-companies-list"},U={key:0,class:"text-center py-8"},W={key:1,class:"text-center py-8"},T={class:"text-red-600"},V={key:2,class:"text-center py-8"},$={key:3,class:"space-y-3"},B={class:"text-lg font-semibold mb-4"},F={class:"space-y-3 pr-2"},K={class:"flex items-center gap-3 flex-1"},S={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},Y={class:"flex-1"},q={class:"flex items-center gap-2"},H={class:"font-medium text-gray-900"},J={key:0,class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"},X={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(M,{expose:b,emit:y}){const a=v([]),g=v(!0),h=v(""),r=v(null),_=v(null),C=o=>{if(!o||o.length<=2)return o;const t=o.split(" ");if(t.length===1){const s=t[0];return s.length<5?s.substring(0,2)+"*".repeat(s.length-2):s.substring(0,2)+"*".repeat(s.length-5)+s.substring(s.length-3)}else return t.map((n,e)=>e===0?n.substring(0,2)+"*".repeat(n.length-2):e===t.length-1&&n.length===3?n:"*".repeat(n.length)).join(" ")},w=o=>r.value?o.companyName+"_"+o.timestamp===r.value:!1,x=async()=>{try{if(g.value=!0,h.value="",window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){const t=await $fetch("/api/companies-list");if(t.success){const n=t.companies.filter(e=>e.status==="approved"||e.status==="Approved").sort((e,i)=>new Date(i.timestamp)-new Date(e.timestamp));if(r.value){const e=a.value.findIndex(i=>i.companyName+"_"+i.timestamp===r.value);if(e!==-1){const i=a.value.splice(e,1)[0];n.unshift(i)}}a.value=n}else h.value=t.error||"Ошибка загрузки данных"}else{const t="https://script.google.com/macros/s/AKfycbxbWqpE_TR7HJoClggVpGBYdUGcssKxWOpbFAa7nZGQp69jrE0hUxLiiCx5nY8T_x70jg/exec",s="callback_approved_companies_"+Date.now();window[s]=e=>{if(e&&e.success){const m=e.companies.filter(l=>l.status==="approved"||l.status==="Approved").sort((l,c)=>new Date(c.timestamp)-new Date(l.timestamp));if(r.value){const l=a.value.findIndex(c=>c.companyName+"_"+c.timestamp===r.value);if(l!==-1){const c=a.value.splice(l,1)[0];m.unshift(c)}}a.value=m}else h.value=e.error||"Ошибка загрузки данных";g.value=!1,delete window[s],document.head.removeChild(n)};const n=document.createElement("script");n.src=`${t}?action=getCompanies&callback=${s}`,document.head.appendChild(n)}}catch(o){console.error("Error fetching approved companies:",o),h.value="Ошибка загрузки данных"}finally{(window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0"))&&(g.value=!1)}},I=async()=>{try{if(window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){const t=await $fetch("/api/companies-list");if(t.success){const n=t.companies.filter(e=>e.status==="approved"||e.status==="Approved").sort((e,i)=>new Date(i.timestamp)-new Date(e.timestamp));if(r.value){const e=a.value.findIndex(i=>i.companyName+"_"+i.timestamp===r.value);if(e!==-1){const i=a.value.splice(e,1)[0];n.unshift(i)}}a.value=n}}else{const t="https://script.google.com/macros/s/AKfycbxbWqpE_TR7HJoClggVpGBYdUGcssKxWOpbFAa7nZGQp69jrE0hUxLiiCx5nY8T_x70jg/exec",s="callback_approved_companies_auto_"+Date.now();window[s]=e=>{if(e&&e.success){const m=e.companies.filter(l=>l.status==="approved"||l.status==="Approved").sort((l,c)=>new Date(c.timestamp)-new Date(l.timestamp));if(r.value){const l=a.value.findIndex(c=>c.companyName+"_"+c.timestamp===r.value);if(l!==-1){const c=a.value.splice(l,1)[0];m.unshift(c)}}a.value=m}delete window[s],document.head.removeChild(n)};const n=document.createElement("script");n.src=`${t}?action=getCompanies&callback=${s}`,document.head.appendChild(n)}}catch(o){console.error("Error during auto refresh:",o)}};b({refresh:async(o=null)=>{if(o){const t=o.companyName+"_"+o.timestamp;r.value=t,a.value.unshift(o)}await x()},fetchCompanies:x});const k=y;return A(a,o=>{k("companies-count-updated",o.length)},{immediate:!0}),L(()=>{x(),_.value=N(()=>{I()},6e4)}),D(()=>{_.value&&clearInterval(_.value)}),(o,t)=>(u(),p("div",P,[g.value?(u(),p("div",U,t[0]||(t[0]=[d("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):h.value?(u(),p("div",W,[d("p",T,"Ошибка загрузки: "+f(h.value),1)])):a.value.length===0?(u(),p("div",V,t[1]||(t[1]=[d("p",{class:"text-gray-600"},"Пока нет одобренных компаний",-1)]))):(u(),p("div",$,[d("h3",B,"APPROVED COMPANIES ("+f(a.value.length)+")",1),d("div",F,[(u(!0),p(G,null,R(a.value,(s,n)=>(u(),p("div",{key:n,class:O(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",w(s)?"bg-blue-50 border-blue-200 shadow-md":"bg-white border-gray-200"])},[d("div",K,[d("div",S,f(n+1),1),d("div",Y,[d("div",q,[d("div",H,f(C(s.companyName))+f(s.industry?" | "+s.industry:""),1),w(s)?(u(),p("span",J," NEW ")):j("",!0),t[2]||(t[2]=d("span",{class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}};export{X as _};
