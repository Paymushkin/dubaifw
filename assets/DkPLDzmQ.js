import{s as I}from"./x_rD_Ya3.js";import{_ as L,r as m,f as D,g as Q,A as R,c,o as p,a as i,t as h,F as U,i as B,n as O,h as P}from"./BRASZyeV.js";const K={class:"approved-companies-list"},S={key:0,class:"text-center py-8"},V={key:1,class:"text-center py-8"},W={class:"text-red-600"},G={key:2,class:"text-center py-8"},M={key:3,class:"space-y-3"},X={class:"text-lg font-semibold mb-4"},$={class:"space-y-3 pr-2"},j={class:"flex items-center gap-3 flex-1"},T={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},F={class:"flex-1"},H={class:"flex items-center gap-2"},J={class:"font-medium text-gray-900"},z={key:0,class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"},q={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(Y,{expose:C,emit:k}){const r=m([]),v=m(!0),u=m(""),d=m(null),g=m(null),A=e=>{if(!e||e.length<=2)return e;const s=e.split(" ");if(s.length===1){const t=s[0];return t.length<5?t.substring(0,2)+"*".repeat(t.length-2):t.substring(0,2)+"*".repeat(t.length-5)+t.substring(t.length-3)}else return s.map((o,l)=>l===0?o.substring(0,2)+"*".repeat(o.length-2):l===s.length-1&&o.length===3?o:"*".repeat(o.length)).join(" ")},w=e=>e?e.companyName+"_"+e.timestamp===d.value:!1,x=e=>{console.log("ApprovedCompaniesList: filtering companies:",e.length),console.log("ApprovedCompaniesList: first company:",e[0]);const s=e.filter(t=>t.status==="approved"||t.status==="Approved");return console.log("ApprovedCompaniesList: approved companies:",s.length),console.log("ApprovedCompaniesList: approved companies:",s),s},_=async()=>{try{v.value=!0,u.value="";const e=window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0");{const s="https://script.google.com/macros/s/AKfycby-9k6uo_l1HnNVUXBC3cmyEgtwb6EJBe7kRnbQ07QKlXLeNMk2QAQoKDUismUx1_DdlQ/exec",t="callback_approved_companies_"+Date.now();window[t]=l=>{if(l&&l.success){const b=l.companies.map((n,a)=>({...n,status:n.status||(a<3?"approved":"waitlist")})),f=x(b).sort((n,a)=>new Date(a.timestamp)-new Date(n.timestamp));if(d.value){const n=r.value.findIndex(a=>a.companyName+"_"+a.timestamp===d.value);if(n!==-1){const a=r.value.splice(n,1)[0];f.unshift(a)}}r.value=f,y("companies-count-updated",r.value.length)}else u.value=l.error||"Ошибка загрузки данных";v.value=!1,delete window[t],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${s}?action=getCompanies&callback=${t}`,document.head.appendChild(o)}}catch(e){console.error("Error fetching approved companies:",e),u.value="Ошибка загрузки данных",v.value=!1}},N=async()=>{try{const e=window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0");{const s="https://script.google.com/macros/s/AKfycby-9k6uo_l1HnNVUXBC3cmyEgtwb6EJBe7kRnbQ07QKlXLeNMk2QAQoKDUismUx1_DdlQ/exec",t="callback_approved_auto_"+Date.now();window[t]=l=>{if(l&&l.success){const b=l.companies.map((n,a)=>({...n,status:n.status||(a<3?"approved":"waitlist")})),f=x(b).sort((n,a)=>new Date(a.timestamp)-new Date(n.timestamp));r.value=f,y("companies-count-updated",r.value.length)}delete window[t],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${s}?action=getCompanies&callback=${t}`,document.head.appendChild(o)}}catch(e){console.error("Error in auto refresh:",e)}};C({refresh:(e=null)=>{e&&(d.value=e.companyName+"_"+e.timestamp),_()},fetchCompanies:_});const y=k;return D(()=>{_(),g.value=I(N,3e4)}),Q(()=>{g.value&&clearInterval(g.value)}),R(d,e=>{e&&setTimeout(()=>{d.value=null},5e3)}),(e,s)=>(p(),c("div",K,[v.value?(p(),c("div",S,s[0]||(s[0]=[i("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):u.value?(p(),c("div",V,[i("p",W,"Ошибка загрузки: "+h(u.value),1)])):r.value.length===0?(p(),c("div",G,s[1]||(s[1]=[i("p",{class:"text-gray-600"},"Пока нет одобренных компаний",-1)]))):(p(),c("div",M,[i("h3",X,"APPROVED COMPANIES ("+h(r.value.length)+")",1),i("div",$,[(p(!0),c(U,null,B(r.value,(t,o)=>(p(),c("div",{key:o,class:O(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",w(t)?"bg-green-50 border-green-200 shadow-md":"bg-blue-50 border-blue-200"])},[i("div",j,[i("div",T,h(o+1),1),i("div",F,[i("div",H,[i("div",J,h(A(t.companyName))+h(t.industry?" | "+t.industry:""),1),w(t)?(p(),c("span",z," NEW ")):P("",!0),s[2]||(s[2]=i("span",{class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}},oe=L(q,[["__scopeId","data-v-51725c82"]]);export{oe as A};
